function NavToggle() {
    $(".navbar-minimalize").trigger("click")
}
function SmoothlyMenu() {
    $("body").hasClass("mini-navbar") ? $("body").hasClass("fixed-sidebar") ? ($("#side-menu").hide(), setTimeout(function() {
        $("#side-menu").fadeIn(500)
    },
    300)) : $("#side-menu").removeAttr("style") : ($("#side-menu").hide(), setTimeout(function() {
        $("#side-menu").fadeIn(500)
    },
    100))
}
function ieVersion() {
    var v = 3, div = document.createElement('div'), all = div.getElementsByTagName('i');
    while (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->', all[0]);
    return v > 4 ? v : false;
}
layer.config({
    extend: ["extend/layer.ext.js", "skin/moon/style.css"],
    skin: "layer-ext-moon"
}),
$(document).ready(function() {
    function e() {
        var e = $("body > #wrapper").height() - 61;
        $(".sidebard-panel").css("min-height", e + "px")
    }
    $("#side-menu").metisMenu({
        toggle:false
    }),
    $(".right-sidebar-toggle").click(function() {
        $("#right-sidebar").toggleClass("sidebar-open")
    }),
    $(".sidebar-container").slimScroll({
        height: "100%",
        railOpacity: .4,
        wheelStep: 10
    }),
    $(".check-link").click(function() {
        var e = $(this).find("i"),
        a = $(this).next("span");
        return e.toggleClass("fa-check-square").toggleClass("fa-square-o"),
        a.toggleClass("todo-completed"),
        !1
    }),
    $(function() {
        $(".sidebar-collapse").slimScroll({
            height: "100%",
            railOpacity: .9,
            alwaysVisible: !1
        })
    });
    $(".navbar-minimalize").click(function() {
        $("body").toggleClass("mini-navbar");
        if(ieVersion()>4){
            $("#side-menu li:gt(0)").find('ul').css('display','none');
        }
        SmoothlyMenu()
    }),
    e(),
    $(window).bind("load resize click scroll",
    function() {
        $("body").hasClass("body-small") || e()
    }),
    $(window).scroll(function() {
        $(window).scrollTop() > 0 && !$("body").hasClass("fixed-nav") ? $("#right-sidebar").addClass("sidebar-top") : $("#right-sidebar").removeClass("sidebar-top")
    }),
    $(".full-height-scroll").slimScroll({
        height: "100%"
    }),
    $("#side-menu>li").click(function() {
        $("body").hasClass("mini-navbar") && NavToggle()
    }),
    $("#side-menu>li li a").click(function() {
        $(window).width() < 769 && NavToggle()
    }),
    $(".nav-close").click(NavToggle),
    /(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent) && $("#content-main").css("overflow-y", "auto")
});
$(window).bind("load resize",
function() {
    $("html").css('display','block').addClass('fadeIn');
    $(this).width() < 769 && ($("body").addClass("mini-navbar"), $(".navbar-static-side").fadeIn());
    $("#content-main").height($("#page-wrapper").height() - $("#content-main").offset().top-parseInt($(".footer").outerHeight()));
});
$(function() {
    if(ieVersion()&&ieVersion()<8){
        $("#right-sidebar .onoffswitch-inner").append($("<span class='before'>ON</span><span class='after'>OFF</span>"));
        }
        $("#right-sidebar .onoffswitch").has($("#fixednavbar")).click(function(event) {
            var $e=$.event.fix(event);
            if($("#fixednavbar").is(":checked") ){
                    $(".navbar-fixed-top").removeClass("navbar-fixed-top").addClass("navbar-static-top");
                    $("body").removeClass("fixed-nav");
                    $("#fixednavbar").prop("checked", false);
                    $(this).removeClass('onoffswitch-on');
                    $.cookie('fixednavbar', 'off', { expires: 365, path: '/' });
             }else{
                    $(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top");
                    $("body").removeClass("boxed-layout");
                    $("body").addClass("fixed-nav");
                    $(".navbar-static-side").height($(window).height()-$(".navbar-static-side").offset().top);
                    $("#fixednavbar").prop("checked", true);
                    $(this).addClass('onoffswitch-on');
                    $("#right-sidebar .onoffswitch").has($("#boxedlayout")).removeClass('onoffswitch-on')
                    $.cookie('fixednavbar', 'on', { expires: 365, path: '/' });
                    $.cookie('boxedlayout', 'off', { expires: 365, path: '/' });
                }
            $e.preventDefault();
        });
        $("#right-sidebar .onoffswitch").has($("#collapsemenu")).click(function(event) {
            var $e=$.event.fix(event);
            if($("#collapsemenu").is(":checked") ){
                    $("body").removeClass("mini-navbar");
                    SmoothlyMenu();
                    $("#collapsemenu").prop("checked",false);
                    $(this).removeClass('onoffswitch-on');
                    $.cookie('collapse_menu', 'off', { expires: 365, path: '/' });
             }else{
                    $("body").addClass("mini-navbar");
                    SmoothlyMenu();
                    $("#collapsemenu").prop("checked",true);
                    $(this).addClass('onoffswitch-on');
                    $.cookie('collapse_menu', 'on', { expires: 365, path: '/' });
                }
            $e.preventDefault();
        });
        $("#right-sidebar .onoffswitch").has($("#boxedlayout")).click(function(event) {
            var $e=$.event.fix(event);
            if($("#boxedlayout").is(":checked") ){
                    $("body").removeClass("boxed-layout");
                    $("#boxedlayout").prop("checked",false);
                    $(this).removeClass('onoffswitch-on');
                    $.cookie('boxedlayout', 'off', { expires: 365, path: '/' });
            }else{
                    $("body").addClass("boxed-layout");
                    $("#boxedlayout").prop("checked",true);
                    $("#fixednavbar").prop("checked", true);
                    $(".navbar-fixed-top").removeClass("navbar-fixed-top").addClass("navbar-static-top");
                    $("body").removeClass("fixed-nav");
                    $(this).addClass('onoffswitch-on');
                    $("#right-sidebar .onoffswitch").has($("#fixednavbar")).removeClass('onoffswitch-on');
                    $.cookie('boxedlayout', 'on', { expires: 365, path: '/' });
                    $.cookie('fixednavbar', 'off', { expires: 365, path: '/' });
                }
            $e.preventDefault();
        });
    $(".s-skin-0").click(function() {
        return $("body").removeClass("skin-1"),
        $("body").removeClass("skin-2"),
        $("body").removeClass("skin-3"),
        !1
    });
    $(".s-skin-1").click(function() {
        return $("body").removeClass("skin-2"),
        $("body").removeClass("skin-3"),
        $("body").addClass("skin-1"),
        !1
    });
    $(".s-skin-3").click(function() {
        return $("body").removeClass("skin-1"),
        $("body").removeClass("skin-2"),
        $("body").addClass("skin-3"),
        !1
    })
    var e = $.cookie("collapse_menu"),
    a = $.cookie("fixednavbar"),
    o = $.cookie("boxedlayout");
    "on" == e && $("#collapsemenu").prop("checked", true),
    "on" == a && $("#fixednavbar").prop("checked", true),
    "on" == o && $("#boxedlayout").prop("checked", true)
    l = $("body");
    "on" == e && (l.hasClass("body-small") || l.addClass("mini-navbar"),$("#right-sidebar .onoffswitch").has($("#collapsemenu")).addClass('onoffswitch-on'));
    if("on" == a){
        $("#right-sidebar .onoffswitch").has($("#fixednavbar")).addClass('onoffswitch-on');
        $(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top");
            $(".navbar-static-side").height($(window).height()-$(".navbar-static-side").offset().top);
        l.addClass("fixed-nav");
    }
    "on" == o && (l.addClass("boxed-layout"),$("#right-sidebar .onoffswitch").has($("#boxedlayout")).addClass('onoffswitch-on'));
});
//扩展部分
$(".navbar-top-links .dropdown-menu").mouseleave(function(){
    $(this).prev().blur();
    $(this).parent().removeClass('open');
});
var setRelativeParent=function(ele){
    if(ele.tagName.toLowerCase()!='html'){
        if($(ele).css('position')!='absolute'&&$(ele).css('position')!='fixed'){
            $(ele).css('position','relative');
            setRelativeParent($(ele).parent()[0]);
        }
    }
}
setRelativeParent($("#right-sidebar .nav")[0]);

$("#right-sidebar").mouseleave(function(){
    $(".sidebar-open").removeClass('sidebar-open');
});



